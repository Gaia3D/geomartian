<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>MagoWorld</title>
	<link rel="stylesheet" href="./demo.css" />
	<link rel="stylesheet" href="../src/engine/cesium/Widgets/widgets.css" />
	<script type="text/javascript" src="../../externlib/jquery/jquery.js"></script>
	<script type="text/javascript" src="../src/engine/cesium/Cesium.js"></script>
	<script type="text/javascript" src="../build/mago3d/mago3d.js"></script>
</head>

<body>
<ul class="nav">
	<li id="homeMenu" class="home">
		<img src="/images/ko/homepage/home-icon.png" style="width: 35px; height: 35px; padding-right: 2px;" title="Home" />
	</li>
	<li onclick="doTest();">
		test
	</li>
</ul>

<div id="magoContainer" style="position: absolute; width:100%; height:100%; margin-top:0; padding:0; overflow:hidden;">
	<canvas id="objectLabel"></canvas>
</div>

<script>
	var managerFactory = null;
	var dataInformationUrl = "/sample/persistence/json/";

	var tt;
	var ttt;
	var tttt;

	magoStart('magoContainer');
    // mago3d start, policy loading
	function magoStart(renderDivId) {
		$.ajax({
			url: dataInformationUrl + "geopolicy.json",
			type: "GET",
			dataType: "json",
			success: function(serverPolicy){

				var osmStreetLayer = new Mago3D.XYZLayer({
					urlFunction : function(coordinate) {
						var url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';
						return url.replace('{z}',coordinate.z)
						.replace('{y}',coordinate.y)
						.replace('{x}',coordinate.x);
					}
				});

				var osmCycleLayer = new Mago3D.XYZLayer({
					urlFunction : function(coordinate) {
						var url = 'https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png';
						return url.replace('{a-c}',getDomainSharding())
						.replace('{z}',coordinate.z)
						.replace('{y}',coordinate.y)
						.replace('{x}',coordinate.x);
						
						function getDomainSharding() {
							var shardingList = ['a','b','c'];
							var randomIndex = Math.floor( (Math.random() * (3)));
							
							return shardingList[randomIndex];
						}
					}
				});
				var bathymetryFilter = {
					type: Mago3D.CODE.imageFilter.BATHYMETRY,
					properties : {
						minAltitude: -200,
						maxAltitude: 1943.14,
						caustics: true
					}
				};
				//tt = new Mago3D.WMSLayer({url: 'http://localhost:8080/geoserver/mago3d/gwc/service/wms', show: true, filter:Mago3D.CODE.imageFilter.BATHYMETRY, minAltitude : -200.0, maxAltitude: 1943.14, param: {layers: 'mago3d:15m_susim', tiled: true}}); // original.*(**)
				tt = new Mago3D.WMSLayer({url: 'http://localhost:8080/geoserver/mago3d/gwc/service/wms', show: true, filter: bathymetryFilter, param: {layers: 'mago3d:15m_susim', tiled: true}}); // new version.
				
				//tt = new Mago3D.WMSLayer({url: 'http://localhost:8080/geoserver/mago3d/gwc/service/wms', show: true, opacity: 0.5, param: {layers: 'mago3d:15m_susim', tiled: true}});
				ttt = new Mago3D.WMSLayer({url: 'http://localhost:8080/geoserver/mago3d/wms', show: true, minZoom:10,   param: {layers: 'mago3d:mj1m', tiled: true}});


				
				/*
				managerFactory = new Mago3D.Mago3d(renderDivId,serverPolicy,undefined,{
					layers : [
						new Mago3D.XYZLayer({url: 'https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'}),
						tt,
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'sk_emd', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'basemap', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'echodelta_25m', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'gangseogu_4326', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'land_block', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'sk_sdo', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'sk_sgg', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'utmk_lsmd_cont_ldreg', tiled: true}}),
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'dem', tiled: true}})
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'district', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
						//new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'ndtp:sk_emd', tiled: true}}),
					]
				});
				*/
				
				
				
				managerFactory = new Mago3D.Mago3d(renderDivId,serverPolicy,undefined,{
					layers : [
						new Mago3D.XYZLayer({url: 'https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'}),
						tt,
						new Mago3D.WMSLayer({url: 'http://192.168.10.9:8080/geoserver/ndtp/wms', show: true,  param: {layers: 'sk_emd', tiled: true}}),
					]
				});
				
				

				var magoManager = managerFactory.getMagoManager();
				var f4dController = managerFactory.getF4dController();

				//magoManager.addLayer(tt);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	
	function doTest(){
		var f4dController = managerFactory.getF4dController();
		$.ajax({
			url: dataInformationUrl + "3ds.json",
			type: "GET",
			dataType: "json",
			success: function(f4dObject){
				console.info(f4dObject);
				f4dController.addF4dGroup(f4dObject);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	
	/*
	function doTest(){
		var f4dController = managerFactory.getF4dController();
		$.ajax({
			url: dataInformationUrl + "workshop-data.json",
			type: "GET",
			dataType: "json",
			success: function(f4dObject){
				console.info(f4dObject);
				f4dController.addF4dGroup(f4dObject);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	*/

</script>
</body>
</html>