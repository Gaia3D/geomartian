<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Cesium</title>
	<link rel="stylesheet" href="/sample/demo.css" />
	<link rel="stylesheet" href="/src/engine/cesium/Widgets/widgets.css" />
	<link rel="stylesheet" href="/externlib/jquery-ui/jquery-ui.css" />
	<script type="text/javascript" src="/externlib/jquery/jquery.js"></script>
	<script type="text/javascript" src="/externlib/jquery-i18next/jquery-i18next.min.js"></script>
	<script type="text/javascript" src="/externlib/polyfill/decodeTextAlternative/encoding-indexes.js"></script>
	<script type="text/javascript" src="/externlib/polyfill/decodeTextAlternative/encoding.js"></script>
</head>

<body>
	<input type="hidden" id="now_latitude" name="now_latitude" value="" />
	<input type="hidden" id="now_longitude" name="now_longitude" value=""  />
<ul class="nav i18n">
	<li id="homeMenu" class="home">
		<img src="/images/ko/homepage/home-icon.png" style="width: 35px; height: 35px; padding-right: 2px;" title="Home" />
	</li>
	<li onclick="doTest();">
		test
	</li>
</ul>
<div id="magoContainer" class="mapWrap"></div>

<script type="text/javascript" src="/src/engine/cesium/Cesium.js"></script>
<script type="text/javascript" src="/build/mago3d/mago3d.js"></script>
<script>
	var SAMPLE_PATH = "/sample/";
	var DATA_INFORMATION_PATH = SAMPLE_PATH + "/persistence/json/";
	var F4D_PATH = SAMPLE_PATH + "/sample/f4d/";

	var MAGO3D_INSTANCE;
	//mago3d 시작
	magoStart(null, "magoContainer", imagePath);

    // mago3d 시작, 정책 데이터 파일을 로딩
	function magoStart(viewer, renderDivId, imagePath) {
		$.ajax({
			url: dataInformationUrl + "geopolicy.json",
			type: "GET",
			dataType: "json",
			success: function(serverPolicy){
				var cesiumViewerOption = {};
				cesiumViewerOption.infoBox = false;
				cesiumViewerOption.navigationHelpButton = false;
				cesiumViewerOption.selectionIndicator = false;
				cesiumViewerOption.homeButton = false;
				cesiumViewerOption.fullscreenButton = false;
				cesiumViewerOption.geocoder = false;
				cesiumViewerOption.baseLayerPicker = false;
				cesiumViewerOption.sceneModePicker = false;

				serverPolicy.basicGlobe = 'cesium';
				serverPolicy.terrainType = 'cesium-default'

				serverPolicy.initLatitude = 37.43601055850527;
				serverPolicy.initLongitude = 126.8008658032687;
				serverPolicy.initAltitude = 3000;
				MAGO3D_INSTANCE = new Mago3D.Mago3d(renderDivId, serverPolicy, {loadend : loadend}, cesiumViewerOption);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	function loadend(e) {
		console.info('Complete construct mago3d instance. Enjoy!');
		
		var magoInstance = e;
		var f4dController = magoInstance.getF4dController();
		console.info(magoInstance)
		magoInstance.getViewer().scene.globe.depthTestAgainstTerrain = true;
		magoInstance.setBaseUrl(dataInfo.baseUrl);

		$.ajax({
			url: dataInformationUrl + "totalJson.json",
			type: "GET",
			dataType: "json",
			success: function(json){
				console.info(json);
				f4dController.addF4dGroup(json);
			},
			error: function(e){
				alert(e.responseText);
			}
		});

		var magoManager = magoInstance.getMagoManager();
		var viewer = magoInstance.getViewer();

		magoManager.on(Mago3D.MagoManager.EVENT_TYPE.CLICK, function(e){
			console.info(e);
			
			// Do a test. Create a geoCoord and render it.
			var screenX = e.point.screenCoordinate.x;
			var screenY = e.point.screenCoordinate.y;
			var posWC = Mago3D.ManagerUtils.screenCoordToWorldCoordUseDepthCheck(screenX, screenY, magoManager);
			var geoCoord = Mago3D.ManagerUtils.pointToGeographicCoord(posWC, undefined);
			geoCoord.makeDefaultGeoLocationData();
			var geoCoordsList = magoManager.modeler.getGeographicCoordsList();
			geoCoordsList.addGeoCoord(geoCoord);
			var hola = 0;
			// End test.----------------------------------
		});

		magoManager.on(Mago3D.MagoManager.EVENT_TYPE.SELECTEDF4D, function(e){
			console.info(e);
		});

		magoManager.on(Mago3D.MagoManager.EVENT_TYPE.DESELECTEDF4D, function(e){
			console.info(e);
		});
	}
	
	var message = new Mago3D.Message(i18next);
	function changeLang(lang) 
	{
		if(i18next === undefined)
		{
			return;
		}
		
		var language = lang || i18next.language;
		var namespace = i18next.options.ns[0];

		$.ajax({
			url: "/locales/"+namespace+"/"+language+".json",
			type: "GET",
			dataType: "json",
			success: function(data){
				i18next.addResourceBundle(language, namespace, data, true, true);
				i18next.changeLanguage(language);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	
	message.init(function (){
		i18next = message.getHandle();
		i18next.on('languageChanged', function (lang) {
			$('.i18n').localize();
		});
		jqueryI18next.init(i18next, $);
		changeLang();
	});
</script>
</body>
</html>