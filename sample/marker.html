<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Cesium</title>
	<link rel="stylesheet" href="/sample/demo.css" />
	<link rel="stylesheet" href="/src/engine/cesium/Widgets/widgets.css" />
	<link rel="stylesheet" href="/externlib/jquery-ui/jquery-ui.css" />
	<script type="text/javascript" src="/externlib/jquery/jquery.js"></script>
	<script type="text/javascript" src="/externlib/jquery-i18next/jquery-i18next.min.js"></script>
	<script type="text/javascript" src="/externlib/polyfill/decodeTextAlternative/encoding-indexes.js"></script>
	<script type="text/javascript" src="/externlib/polyfill/decodeTextAlternative/encoding.js"></script>
</head>

<body>
	<input type="hidden" id="now_latitude" name="now_latitude" value="" />
	<input type="hidden" id="now_longitude" name="now_longitude" value=""  />
<ul class="nav i18n">
	<li id="homeMenu" class="home">
		<img src="/images/ko/homepage/home-icon.png" style="width: 35px; height: 35px; padding-right: 2px;" title="Home" />
	</li>
	<li onclick="gotoDoc();">
		doc
	</li>
    <li onclick="window.changeMode('marker');">
		기본마커
	</li>
    <li onclick="window.targetMarker();">
		기본마커(타겟)
	</li>
    <li onclick="window.changeMode('speechBubble');">
		말풍선
	</li>
</ul>
<div id="magoContainer" class="mapWrap"></div>

<script type="text/javascript" src="/src/engine/cesium/Cesium.js"></script>
<script type="text/javascript" src="/build/mago3d/mago3d.js"></script>
<script>
	var SAMPLE_PATH = "/sample/";
	var DATA_INFORMATION_PATH = SAMPLE_PATH + "persistence/json/";
	var F4D_PATH = SAMPLE_PATH + "f4d";

	var MAGO3D_INSTANCE;
    var mode;
    function changeMode(m) {
        mode = m;
    }
    // mago3d 시작, 정책 데이터 파일을 로딩
	$.ajax({
		url: DATA_INFORMATION_PATH + "geopolicy.json",
		type: "GET",
		dataType: "json",
		success: function(serverPolicy){
			var cesiumViewerOption = {};
			cesiumViewerOption.infoBox = false;
			cesiumViewerOption.navigationHelpButton = false;
			cesiumViewerOption.selectionIndicator = false;
			cesiumViewerOption.homeButton = false;
			cesiumViewerOption.fullscreenButton = false;
			cesiumViewerOption.geocoder = false;
			cesiumViewerOption.baseLayerPicker = false;
			cesiumViewerOption.sceneModePicker = false;

			MAGO3D_INSTANCE = new Mago3D.Mago3d("magoContainer", serverPolicy, {loadend : loadend}, cesiumViewerOption);
		},
		error: function(e){
			alert(e.responseText);
		}
	});

    //Mago3d 객체가 생성된 후 실행되는 소스
	function loadend(e) {
		console.info('Complete construct mago3d instance. Enjoy!');
		
		var magoInstance = e;
		var f4dController = magoInstance.getF4dController();
		var viewer = magoInstance.getViewer();
		var magoManager = magoInstance.getMagoManager();

		viewer.scene.globe.depthTestAgainstTerrain = true;
		magoInstance.setBaseUrl(F4D_PATH);

		$.ajax({
			url: DATA_INFORMATION_PATH + "guide-data.json",
			type: "GET",
			dataType: "json",
			success: function(json){
				f4dController.addF4dGroup(json);
			},
			error: function(e){
				alert(e.responseText);
			}
		});

        magoManager.on(Mago3D.MagoManager.EVENT_TYPE.CLICK, function(e){
            console.info(e);
            var point = e.point.worldCoordinate;

            switch(mode) {
                case 'marker' : {
                    marker(point);
                    break;
                }
                case 'speechBubble' : {
                    speech(point);
                    break;
                }
            }
		});
	}

    function marker(position) {
        var magoManager = MAGO3D_INSTANCE.getMagoManager();
        var objMarkerManager = magoManager.objMarkerManager;

        var createMarkerOption = {
            positionWC : position,
            imageFilePath : '/images/ko/defaultBlue.png',
            sizeX : 32,
            sizeY : 32
        }
        
        objMarkerManager.newObjectMarker(createMarkerOption, magoManager);
    }

    function targetMarker() {

        var magoManager = MAGO3D_INSTANCE.getMagoManager();
        var objMarkerManager = magoManager.objMarkerManager;

        var createMarkerOption = {
            target : {
                buildingId : 'SOCIALROOM',
                projectId : 1 
            },
            imageFilePath : '/images/ko/defaultBlue.png',
            sizeX : 128,
            sizeY : 128
        }
        
        objMarkerManager.newObjectMarker(createMarkerOption, magoManager);
    }

    function speech(position) {
        var magoManager = MAGO3D_INSTANCE.getMagoManager();
        var objMarkerManager = magoManager.objMarkerManager;

        var createMarkerOption = {
            positionWC : position,
            speechBubbleOptions : {
                width : 32,
                height : 32,
                bubbleColor : new Mago3D.Color(0.4,0.4,0.7),
                commentTextOption : {
                    pixel : '10',
                    color : '#fff',
                    borderColor : '#000',
                    text : '교육'
                }
            }
        }
        
        objMarkerManager.newObjectMarkerSpeechBubble(createMarkerOption, magoManager);
    }

	function gotoDoc() {
		window.open('/doc/index.html');
	}
</script>
</body>
</html>